(function(f){f.fn.extend({tableExport:function(q){function t(l,e,d,h){f(l).filter(":visible").find(e).each(function(l){if("none"!=f(this).css("display")&&"none"!=f(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(l)&&"function"===typeof h){var e=0;if("undefined"!=typeof w[d]&&0<w[d].length)for(c=0;c<=l;c++)"undefined"!=typeof w[d][c]&&(h(null,d,c),delete w[d][c],l++);h(this,d,l);if(f(this).is("[colspan]"))for(e=f(this).attr("colspan"),c=0;c<e-1;c++)h(null,d,l+c);if(f(this).is("[rowspan]")){var b=
parseInt(f(this).attr("rowspan"));for(r=1;r<b;r++)for("undefined"==typeof w[d+r]&&(w[d+r]=[]),w[d+r][l]="",c=1;c<e;c++)w[d+r][l+c]=""}}})}function G(l){!0===a.consoleLog&&console.log(l.output());if("string"==a.outputMode)return l.output();if("base64"==a.outputMode)return x(l.output());try{var e=l.output("blob");saveAs(e,a.fileName+".pdf")}catch(d){y(a.fileName+".pdf","data:application/pdf;base64,"+x(l.output()))}}function H(l,e,d){var h="";if(null!=l)if(e=u(l,e,d),l=null===e||""==e?"":e.toString(),
e instanceof Date)h=a.csvEnclosure+e.toLocaleString()+a.csvEnclosure;else if(e=a.csvEnclosure+a.csvEnclosure,h=l.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),e),0<=h.indexOf(a.csvSeparator)||/[\r\n ]/g.test(h))h=a.csvEnclosure+h+a.csvEnclosure;return h}function u(l,e,d){var h="";null!=l&&(l=f(l),h=!0===a.htmlContent?l.html().trim():l.text().trim().replace(/\u00AD/g,""),!0===a.escape&&(h=escape(h)),"function"===typeof a.onCellData&&(h=a.onCellData(l,e,d,h)));
return h}function N(a,e,d){return e+"-"+d.toLowerCase()}function z(a,e){try{return window.getComputedStyle?(e=e.replace(/([a-z])([A-Z])/,N),window.getComputedStyle(a,null).getPropertyValue(e)):a.currentStyle?a.currentStyle[e]:a.style[e]}catch(d){}return""}function F(a,e,d){e=z(a,e).match(/\d+/);if(null!==e){e=e[0];var h=document.createElement("div");h.style.overflow="hidden";h.style.visibility="hidden";a.parentElement.appendChild(h);h.style.width=100+d;d=100/h.offsetWidth;a.parentElement.removeChild(h);
return e*d}return 0}function y(a,e){var d=document.createElement("a");if(d){document.body.appendChild(d);d.style="display: none";d.download=a;d.href=e;if(document.createEvent)null==C&&(C=document.createEvent("MouseEvents")),C.initEvent("click",!0,!1),d.dispatchEvent(C);else if(document.createEventObject)d.fireEvent("onclick");else if("function"==typeof d.onclick)d.onclick();document.body.removeChild(d)}}function x(a){var e="",d,h,b,f,g,k,m=0;a=a.replace(/\x0d\x0a/g,"\n");h="";for(b=0;b<a.length;b++)f=
a.charCodeAt(b),128>f?h+=String.fromCharCode(f):(127<f&&2048>f?h+=String.fromCharCode(f>>6|192):(h+=String.fromCharCode(f>>12|224),h+=String.fromCharCode(f>>6&63|128)),h+=String.fromCharCode(f&63|128));for(a=h;m<a.length;)d=a.charCodeAt(m++),h=a.charCodeAt(m++),b=a.charCodeAt(m++),f=d>>2,d=(d&3)<<4|h>>4,g=(h&15)<<2|b>>6,k=b&63,isNaN(h)?g=k=64:isNaN(b)&&(k=64),e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return e}var a={csvSeparator:",",csvEnclosure:'"',consoleLog:!1,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,
tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"},C=null,w=[];f.extend(!0,a,q);if("csv"==a.type||"txt"==a.type){var g="",n=0;f(this).find("thead").first().find(a.theadSelector).each(function(){g+="\n";t(this,"th,td",n,function(l,e,d){g+=H(l,e,d)+a.csvSeparator});n++;g=f.trim(g);g=f.trim(g).substring(0,g.length-1)});f(this).find("tbody").first().find(a.tbodySelector).each(function(){trData=
"";t(this,"td",n,function(l,e,d){trData+=H(l,e,d)+a.csvSeparator});trData.length>a.csvSeparator.length&&(g+="\n"+trData);n++;g=f.trim(g).substring(0,g.length-1)});g+="\n";!0===a.consoleLog&&console.log(g);if("string"===a.outputMode)return g;if("base64"===a.outputMode)return x(g);try{var v=new Blob([("csv"==a.type?"\ufeff":"")+g],{type:"text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8"});saveAs(v,a.fileName+"."+a.type)}catch(O){y(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+
";charset=utf-8,"+("csv"==a.type?"\ufeff":"")+encodeURIComponent(g))}}else if("sql"==a.type){n=0;g="INSERT INTO `"+a.tableName+"` (";f(this).find("thead").first().find(a.theadSelector).each(function(){t(this,"th,td",n,function(a,e,d){g+="'"+u(a,e,d)+"',"});n++;g=f.trim(g);g=f.trim(g).substring(0,g.length-1)});g+=") VALUES ";f(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";t(this,"td",n,function(a,e,d){trData+="'"+u(a,e,d)+"',"});3<trData.length&&(g+="("+trData,g=f.trim(g).substring(0,
g.length-1),g+="),");n++});g=f.trim(g).substring(0,g.length-1);g+=";";!0===a.consoleLog&&console.log(g);if("string"==a.outputMode)return g;if("base64"==a.outputMode)return x(g);try{v=new Blob([g],{type:"text/plain;charset=utf-8"}),saveAs(v,a.fileName+".sql")}catch(P){y(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(g))}}else if("json"==a.type){var I=[];f(this).find("thead").first().find(a.theadSelector).each(function(){var a=[];t(this,"th,td",n,function(e,d,h){a.push(u(e,
d,h))});I.push(a)});var J=[];f(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=[];t(this,"td",n,function(e,d,h){a.push(u(e,d,h))});0<a.length&&(1!=a.length||""!=a[0])&&J.push(a);n++});q=[];q.push({header:I,data:J});var b=JSON.stringify(q);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;q=x(b);if("base64"==a.outputMode)return q;try{v=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(v,a.fileName+".json")}catch(Q){y(a.fileName+".json","data:application/json;charset=utf-8;base64,"+
q)}}else if("xml"===a.type){var n=0,p='<?xml version="1.0" encoding="utf-8"?>',p=p+"<tabledata><fields>";f(this).find("thead").first().find(a.theadSelector).each(function(){t(this,"th,td",n,function(a,e,d){p+="<field>"+u(a,e,d)+"</field>"});n++});var p=p+"</fields><data>",D=1;f(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=1,e="";t(this,"td",n,function(d,h,b){e+="<column-"+a+">"+u(d,h,b)+"</column-"+a+">";a++});"<column-1></column-1>"!=e&&(p+='<row id="'+D+'">'+e+"</row>",
D++);n++});p+="</data></tabledata>";!0===a.consoleLog&&console.log(p);if("string"==a.outputMode)return p;q=x(p);if("base64"==a.outputMode)return q;try{v=new Blob([p],{type:"application/xml;charset=utf-8"}),saveAs(v,a.fileName+".xml")}catch(R){y(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+q)}}else if("excel"==a.type||"doc"==a.type){var n=0,k="<table>";f(this).find("thead").first().find(a.theadSelector).each(function(){k+="<tr>";t(this,"th,td",n,function(b,e,d){if(null!=b){k+="<td style='";
for(var h in a.excelstyles)a.excelstyles.hasOwnProperty(h)&&(k+=a.excelstyles[h]+": "+f(b).css(a.excelstyles[h])+";");k+="'>"+u(b,e,d)+"</td>"}});n++;k+="</tr>"});D=1;f(this).find("tbody").first().find(a.tbodySelector).each(function(){k+="<tr>";t(this,"td",n,function(b,e,d){if(null!=b){k+="<td style='";for(var h in a.excelstyles)a.excelstyles.hasOwnProperty(h)&&(k+=a.excelstyles[h]+": "+f(b).css(a.excelstyles[h])+";");f(b).is("[colspan]")&&(k+="' colspan='"+f(b).attr("colspan"));f(b).is("[rowspan]")&&
(k+="' rowspan='"+f(b).attr("rowspan"));k+="'>"+u(b,e,d)+"</td>"}});D++;n++;k+="</tr>"});a.displayTableName&&(k+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+u(f("<p>"+a.tableName+"</p>"))+"</td></tr>");k+="</table>";!0===a.consoleLog&&console.log(k);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+a.type+'; charset=UTF-8">';
b=b+'<meta http-equiv="content-type" content="application/'+("excel"===a.type?"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"===a.type&&(b+="\x3c!--[if gte mso 9]>",b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+="</xml>",b+="<![endif]--\x3e");
b+="</head>";b+="<body>";b+=k;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;q=x(b);if("base64"===a.outputMode)return q;var K="excel"===a.type?"xls":"doc";try{v=new Blob([b],{type:"application/vnd.ms-"+a.type}),saveAs(v,a.fileName+"."+K)}catch(S){y(a.fileName+"."+K,"data:application/vnd.ms-"+a.type+";base64,"+q)}}else if("png"==a.type)html2canvas(f(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var e=atob(b),d=new ArrayBuffer(e.length),h=new Uint8Array(d),f=0;f<
e.length;f++)h[f]=e.charCodeAt(f);try{var g=new Blob([d],{type:"image/png"});saveAs(g,a.fileName+".png")}catch(k){y(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type)if(!1===a.jspdf.autotable){var v={dim:{w:F(f(this).first().get(0),"width","mm"),h:F(f(this).first().get(0),"height","mm")},pagesplit:!1},L=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);L.addHTML(f(this).first(),a.jspdf.margins.left,a.jspdf.margins.top,v,function(){G(L)})}else{var m=a.jspdf.autotable.tableExport;
if("string"===typeof a.jspdf.format&&"bestfit"===a.jspdf.format.toLowerCase()){var A={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},E="",B="",M=0;f(this).filter(":visible").each(function(){if("none"!=f(this).css("display")){var a=F(f(this).get(0),"width","pt");if(a>M){a>A.a0[0]&&(E="a0",B="l");for(var b in A)A.hasOwnProperty(b)&&A[b][1]>a&&(E=b,B="l",A[b][0]>a&&(B="p"));M=a}}});a.jspdf.format=""==E?"a4":E;a.jspdf.orientation=""==B?"w":B}m.doc=
new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);f(this).filter(":visible").each(function(){if("none"!=f(this).css("display")){var b,e=0,d={};m.columns=[];m.rows=[];m.rowoptions={};if("function"===typeof m.onTable&&!1===m.onTable(f(this),a))return!0;Object.keys(a.jspdf.autotable).forEach(function(b){d[b]=a.jspdf.autotable[b]});d.margins={};f.extend(!0,d.margins,a.jspdf.margins);"function"!==typeof d.renderCell&&(d.renderCell=function(a,b,e,d,f,g,k,l){var m=l.tableExport.doc,n=0;m.setFillColor(0===
k%2?245:255);m.setTextColor(50);m.rect(a,b,e,d,"F");b+=l.lineHeight/2+m.autoTableTextHeight()/2-2.5;"undefined"!=typeof l.tableExport.columns[f]&&(d=l.tableExport.columns[f].style.align,f=l.tableExport.rowoptions[k+1+":"+f],void 0!==f&&(d=f.style.align),"right"==d?n=e-m.getStringUnitWidth(""+g)*m.internal.getFontSize()-l.padding:"center"==d&&(n=(e-m.getStringUnitWidth(""+g)*m.internal.getFontSize())/2));n<l.padding&&(n=l.padding);m.text(g,a+n,b)});f(this).find("thead").find(a.theadSelector).each(function(){b=
0;t(this,"th,td",e,function(a,d,e){a={title:u(a,d,e),key:b++,style:{align:z(a,"text-align"),bcolor:z(a,"background-color")}};m.columns.push(a)});e++});f(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];b=0;t(this,"td",e,function(d,f,g){var k={style:{align:z(d,"text-align"),bcolor:z(d,"background-color")}};m.rowoptions[e+":"+b++]=k;a.push(u(d,f,g))});e++;m.rows.push(a)});if("function"===typeof m.onBeforeAutotable)m.onBeforeAutotable(f(this),m.columns,m.rows,d);m.doc.autoTable(m.columns,
m.rows,d);if("function"===typeof m.onAfterAutotable)m.onAfterAutotable(f(this),d);a.jspdf.autotable.startY=m.doc.autoTableEndPosY()+d.margins.top}});G(m.doc);m.columns.length=0;m.rows.length=0;delete m.doc;m.doc=null}return this}})})(jQuery);
